import{r as b,w as z,f as B,d as D,e as I,j as e,t as L,x as T}from"./index-BQzuh-gl.js";import{z as n,u as U,I as c,s as H}from"./input-BmnTGpF_.js";import{R as O,C as _,S as G}from"./Spinner-jn7EIcrl.js";import{F as J}from"./Form-d93rxYQ-.js";import"./warning-DLf8qE4y.js";const K=n.object({firstName:n.string().min(1,{message:"First name is required"}),lastName:n.string().min(1,{message:"Last name is required"}),email:n.string().email(),password:n.string().min(8,{message:"Password must be at least 8 characters"}).regex(/.*[!@#$%^&*()_+{}|[\]\\:";'<>?,./].*/,{message:"Password should contain at least 1 special character"}),confirmPassword:n.string().min(8,{message:"Password must be at least 8 characters"})}).refine(i=>i.password===i.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]}),M=()=>{const[i,a]=b.useState("idle"),[r,d]=b.useState(null);return{emailStatus:i,preveEmail:r,setEmailStatus:a,checkEmailAvailability:async u=>{d(u),a("checking");try{(await z.get(`/users?email=${u}`)).data.length?a("notAvailable"):a("available")}catch{a("failed")}},resetCheckEmailAvailability:()=>{a("idle"),d(null)}}},Z=()=>{var v,x,y,E,S,j;const i=B(),{loading:a,error:r,accessToken:d}=D(o=>o.auth),[g,f]=b.useState(!1),u=I(),{register:s,handleSubmit:N,getFieldState:k,trigger:A,formState:{errors:l}}=U({mode:"all",resolver:H(K)}),{emailStatus:t,preveEmail:P,setEmailStatus:C,checkEmailAvailability:F,resetCheckEmailAvailability:R}=M(),w=async o=>{await A("email");const m=o.target.value,{isDirty:p,invalid:h}=k("email");p&&!h&&m!==P&&(C("checking"),await F(m)),p&&h&&m&&R()};b.useEffect(()=>{f(!!(r||t==="notAvailable"))},[r,t]);const $=o=>{if(!g){const{firstName:m,lastName:p,email:h,password:q}=o;i(T({firstName:m,lastName:p,email:h,password:q})).unwrap().then(()=>u("/login?message=Now you can login"))}};return d?e.jsx(L,{to:"/"}):e.jsx(e.Fragment,{children:e.jsx(O,{children:e.jsx(_,{md:{span:6,offset:3},children:e.jsxs(J,{onSubmit:N($),children:[e.jsx(c,{label:"First Name",register:s,name:"firstName",error:(v=l.firstName)==null?void 0:v.message}),e.jsx(c,{label:"Last Name",register:s,name:"lastName",error:(x=l.lastName)==null?void 0:x.message}),e.jsx(c,{label:"Email",register:s,name:"email",onBlur:w,onChange:w,error:(y=l.email)!=null&&y.message?(E=l.email)==null?void 0:E.message:t==="notAvailable"?"This email is already in use.":t==="failed"?"Error from the server.":"",sucsses:t==="available",checking:t==="checking",disabled:t==="checking"}),e.jsx(c,{label:"Password",type:"password",register:s,name:"password",error:(S=l.password)==null?void 0:S.message}),e.jsx(c,{label:"Confirm Password",type:"password",register:s,name:"confirmPassword",error:(j=l.confirmPassword)==null?void 0:j.message}),e.jsx("button",{onClick:()=>g,type:"submit",className:`btn ${g?"btn-secondary":"btn-primary"}`,children:a==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(G,{animation:"border",size:"sm"})," loading"]}):"Submit"}),r&&e.jsx("div",{className:"alert alert-danger mt-2",role:"alert",children:r})]})})})})};export{Z as default};
